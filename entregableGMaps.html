<html>

<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<link href="css/default.css" rel="stylesheet" type="text/css" />
	<title>Superposici√≥n capas WMS sobre Google Maps v3</title>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?"></script>
	<script type="text/javascript">
		var contador = 1;
		var selected_marker = null;

		var WMS_URL = 'http://ide.gijon.es:8080/geoserver/wms?';
		var WMS_Layers = '';//'Gijon:Rios,Gijon:LU_Zona_Verde,Gijon:Rutas_Verdes,Gijon:Zona_Verde,Gijon:Playas,Gijon:Instalaciones_Deportivas,Gijon:Colegios_Electorales';
		var map;
		var markersArray = [];
		var TileWMS = function (coord, zoom) {
			var proj = map.getProjection();
			var zfactor = Math.pow(2, zoom);
			var top = proj.fromPointToLatLng(new google.maps.Point(coord.x * 256 / zfactor, coord.y * 256 / zfactor));
			var bot = proj.fromPointToLatLng(new google.maps.Point((coord.x + 1) * 256 / zfactor, (coord.y + 1) * 256 / zfactor));
			var bbox = top.lng() + "," + bot.lat() + "," + bot.lng() + "," + top.lat();

			var myURL = WMS_URL + "SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&SRS=EPSG%3A4326&WIDTH=256&HEIGHT=256&FORMAT=image/png&TRANSPARENT=TRUE";
			myURL += "&LAYERS=" + WMS_Layers;
			myURL += "&BBOX=" + bbox;
			console.log(myURL);
			return myURL;
		}

		function initialize() {
			var logrono = new google.maps.LatLng(43.540935, -5.673168);
			var misOpciones = {
				zoom: 13,
				center: logrono,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};
			map = new google.maps.Map(document.getElementById("map_canvas"), misOpciones);

			var overlayOptions =
			{
				getTileUrl: TileWMS,
				tileSize: new google.maps.Size(256, 256)
			};
			var overlayWMS = new google.maps.ImageMapType(overlayOptions);
			map.overlayMapTypes.push(overlayWMS);
		}

		function check(cb) {
			let checked = cb.checked;
			if (checked) {
				if (WMS_Layers === "") {
					WMS_Layers = WMS_Layers.concat(cb.value);
				} else {
					WMS_Layers = WMS_Layers.concat("," + cb.value);
				}
				console.log(cb.value);
			} else {
				WMS_Layers = WMS_Layers.replace(`,${cb.value}`, '');
				WMS_Layers = WMS_Layers.replace(`${cb.value}`, '');
				if (WMS_Layers.charAt(0) === ",") {
					WMS_Layers = WMS_Layers.slice(1);
				}
			}
			initialize();
		}
	</script>
	<style>
		html,
		body {
			height: 100%;
			margin: 0;
			padding: 0;
		}

		.grid {
			display: grid;
			grid-template-columns: 2fr 1fr;
			grid-template-rows: auto;
			grid-template-areas:
				"map overlay"
				"map overlay";
		}

		.map {
			grid-area: "map";
		}

		.overlay {
			grid-area: overlay;
			display: flex;
			flex-direction: column;
		}

		#map_canvas {
			height: 100vh;
		}

		.checkbox {}
	</style>
</head>

<body onload="initialize()">
	<div class="grid">
		<div id="map_canvas" class="map"></div>
		<div class="overlay">
			Areas Planta: <input type="checkbox" id="zona_verde"
				value="Gijon:LU_Zona_Verde,Gijon:Rutas_Verdes,Gijon:Zona_Verde" onclick="check(this);"
				class="checkbox" />
			Areas Agua: <input type="checkbox" id="zona_agua" value="Gijon:Rios" onclick="check(this);"
				class="checkbox" />
			Areas Tierra: <input type="checkbox" id="zona_agua" value="Gijon:Playas" onclick="check(this);"
				class="checkbox" />
			Colegios y pistas deportivas: <input type="checkbox" id="POIs"
				value="Gijon:Colegios_Electorales,Gijon:Instalaciones_Deportivas" onclick="check(this);"
				class="checkbox" />
		</div>

	</div>
</body>

</html>